<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteCraft - Transform Your Notes into Beautiful Handwriting</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Kalam:wght@300;400;700&family=Patrick+Hand&family=Indie+Flower&family=Dancing+Script:wght@400;700&family=Space+Mono:wght@400;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #3498db;
            --bg-light: #f8f9fa;
            --bg-dark: #1a1a2e;
            --text-light: #2c3e50;
            --text-dark: #ecf0f1;
            --border: #ddd;
            --shadow: rgba(0, 0, 0, 0.1);
            
            /* Paper colors */
            --paper-white: #ffffff;
            --paper-cream: #fef9e7;
            --paper-yellow: #fffacd;
            --paper-blue: #e8f4f8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--text-dark);
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--secondary);
        }

        body.dark-mode .header {
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 3px solid var(--accent);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            font-size: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: var(--accent);
            border: none;
            color: white;
            padding: 0.7rem 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Manrope', sans-serif;
            font-weight: 600;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Control Panel */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px var(--shadow);
            height: fit-content;
        }

        body.dark-mode .control-panel {
            background: rgba(26, 26, 46, 0.95);
        }

        .control-section {
            margin-bottom: 2rem;
        }

        .control-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        body.dark-mode .control-section h3 {
            color: var(--accent);
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Manrope', sans-serif;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        body.dark-mode textarea {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
        }

        /* Style Options */
        .style-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .style-option {
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }

        body.dark-mode .style-option {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .style-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .style-option.active {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.1);
        }

        .style-option .preview {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .style-option .name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Color Picker */
        .color-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }

        .color-btn::after {
            content: '';
            position: absolute;
            inset: -8px;
            border: 2px solid transparent;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .color-btn.active::after {
            border-color: var(--accent);
        }

        /* Paper Type */
        .paper-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .paper-option {
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }

        body.dark-mode .paper-option {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .paper-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .paper-option.active {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.1);
        }

        /* Sliders */
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--accent), var(--secondary));
            outline: none;
            --webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--accent);
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--accent);
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow);
        }

        .slider-value {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Preview Panel */
        .preview-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px var(--shadow);
            position: sticky;
            top: 100px;
            max-height: calc(100vh - 120px);
            overflow: auto;
        }

        body.dark-mode .preview-panel {
            background: rgba(26, 26, 46, 0.95);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .preview-header h3 {
            font-size: 1.3rem;
            color: var(--secondary);
        }

        body.dark-mode .preview-header h3 {
            color: var(--accent);
        }

        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: var(--accent);
            border: none;
            color: white;
            padding: 0.6rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        /* Paper Preview */
        .paper-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        #paperPreview {
            width: 100%;
            padding: 3rem;
            min-height: 400px;
            position: relative;
            background: var(--paper-white);
            background-size: 100% 30px;
            font-size: 20px;
            line-height: 1.8;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Column layouts */
        #paperPreview.layout-double {
            column-count: 2;
            column-gap: 2rem;
            column-rule: 1px solid rgba(0, 0, 0, 0.1);
        }

        #paperPreview.layout-triple {
            column-count: 3;
            column-gap: 1.5rem;
            column-rule: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Main headings span across all columns */
        #paperPreview h1 {
            column-span: all;
            -webkit-column-span: all;
            text-align: left;
            border-bottom: 3px solid currentColor;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem !important;
            page-break-after: avoid;
            break-after: avoid;
        }

        /* Section headings also span columns */
        #paperPreview h2 {
            column-span: all;
            -webkit-column-span: all;
            text-align: left;
            border-bottom: 2px dashed currentColor;
            padding-bottom: 0.3rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem !important;
            page-break-after: avoid;
            break-after: avoid;
        }

        /* Compact mode */
        #paperPreview.compact-mode {
            padding: 2rem;
        }

        #paperPreview.compact-mode h1,
        #paperPreview.compact-mode h2,
        #paperPreview.compact-mode h3 {
            margin: 0.5rem 0 0.3rem 0;
        }

        #paperPreview.compact-mode ul,
        #paperPreview.compact-mode ol {
            margin-bottom: 0.5rem;
        }

        #paperPreview.compact-mode li {
            margin-bottom: 0.2rem;
        }

        /* Prevent column breaks in important elements */
        .layout-double h3, .layout-triple h3 {
            break-after: avoid;
            page-break-after: avoid;
        }

        .layout-double ul, .layout-double ol,
        .layout-triple ul, .layout-triple ol {
            break-inside: avoid;
            page-break-inside: avoid;
        }

        /* Box styling for important content */
        .handwritten-text .box {
            border: 2px solid currentColor;
            padding: 0.8rem;
            margin: 1rem 0;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.3);
            break-inside: avoid;
            page-break-inside: avoid;
        }

        .handwritten-text .important-box {
            border: 3px double currentColor;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(255, 235, 59, 0.15);
            break-inside: avoid;
            page-break-inside: avoid;
        }

        .handwritten-text .formula-box {
            background: rgba(52, 152, 219, 0.05);
            border-left: 4px solid currentColor;
            padding: 0.8rem;
            margin: 0.8rem 0;
            break-inside: avoid;
            page-break-inside: avoid;
        }

        /* Decorative underlines */
        .handwritten-text .underline {
            text-decoration: underline;
            text-decoration-style: wavy;
            text-decoration-color: currentColor;
        }

        .handwritten-text .double-underline {
            border-bottom: 3px double currentColor;
            display: inline-block;
            padding-bottom: 2px;
        }

        /* Star/Important markers */
        .handwritten-text .star::before {
            content: '‚≠ê ';
        }

        .handwritten-text .important::before {
            content: '‚ùó ';
        }

        .handwritten-text .note::before {
            content: 'üìå ';
        }

        .handwritten-text .tip::before {
            content: 'üí° ';
        }

        /* Margin notes */
        .handwritten-text .margin-note {
            float: right;
            width: 30%;
            padding: 0.5rem;
            margin: 0 0 1rem 1rem;
            background: rgba(255, 235, 59, 0.2);
            border-left: 3px solid currentColor;
            font-size: 0.85em;
            break-inside: avoid;
        }

        /* Arrows and connectors */
        .handwritten-text .arrow-right::after {
            content: ' ‚Üí';
        }

        .handwritten-text .arrow-left::before {
            content: '‚Üê ';
        }

        .handwritten-text .arrow-both::before {
            content: '‚Üî ';
        }

        /* Different bullet styles */
        .handwritten-text ul.dash-bullets li::marker {
            content: '‚Äì ';
        }

        .handwritten-text ul.arrow-bullets li::marker {
            content: '‚û§ ';
        }

        .handwritten-text ul.star-bullets li::marker {
            content: '‚òÖ ';
        }

        .handwritten-text ul.check-bullets li::marker {
            content: '‚úì ';
        }

        /* Circle important text */
        .handwritten-text .circled {
            border: 2px solid currentColor;
            border-radius: 50%;
            padding: 0.2rem 0.6rem;
            display: inline-block;
        }

        /* Date/Header stamp */
        .handwritten-text .date-stamp {
            text-align: right;
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 1rem;
        }

        /* Page decoration */
        .handwritten-text .divider {
            text-align: center;
            margin: 1.5rem 0;
            font-size: 1.2em;
        }

        .handwritten-text .divider::before,
        .handwritten-text .divider::after {
            content: '‚îÄ‚îÄ‚îÄ';
            margin: 0 1rem;
        }

        /* Paper backgrounds */
        .paper-ruled {
            background-image: repeating-linear-gradient(
                transparent,
                transparent 29px,
                #e0e0e0 29px,
                #e0e0e0 30px
            );
        }

        .paper-dotted {
            background-image: radial-gradient(circle, #d0d0d0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .paper-grid {
            background-image: 
                repeating-linear-gradient(0deg, #e0e0e0 0px, #e0e0e0 1px, transparent 1px, transparent 20px),
                repeating-linear-gradient(90deg, #e0e0e0 0px, #e0e0e0 1px, transparent 1px, transparent 20px);
            background-size: 20px 20px;
        }

        /* Canvas for drawing */
        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            pointer-events: none;
        }

        #drawingCanvas.drawing-enabled {
            pointer-events: all;
        }

        /* Drawing tools */
        .drawing-tools {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
        }

        .tool-btn {
            padding: 0.6rem 1rem;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        body.dark-mode .tool-btn {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px var(--shadow);
        }

        .tool-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Export Buttons */
        .export-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .export-btn {
            padding: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Manrope', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .export-btn.pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .export-btn.png {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .export-btn.jpg {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        /* Handwriting Styles */
        .font-caveat { font-family: 'Caveat', cursive; }
        .font-kalam { font-family: 'Kalam', cursive; }
        .font-patrick { font-family: 'Patrick Hand', cursive; }
        .font-indie { font-family: 'Indie Flower', cursive; }
        .font-dancing { font-family: 'Dancing Script', cursive; }

        /* Text formatting */
        .handwritten-text h1,
        .handwritten-text h2,
        .handwritten-text h3 {
            font-weight: 700;
            margin: 1rem 0 0.5rem 0;
        }

        .handwritten-text h1 { font-size: 2em; }
        .handwritten-text h2 { font-size: 1.7em; }
        .handwritten-text h3 { font-size: 1.4em; }

        .handwritten-text ul,
        .handwritten-text ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .handwritten-text li {
            margin-bottom: 0.5rem;
        }

        .handwritten-text strong {
            font-weight: 700;
        }

        .handwritten-text em {
            font-style: italic;
        }

        .handwritten-text mark {
            background: rgba(255, 235, 59, 0.4);
            padding: 2px 4px;
        }

        /* Loading indicator */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 2rem 3rem;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            z-index: 1000;
            display: none;
        }

        .loading.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .preview-panel {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .logo h1 {
                font-size: 1.4rem;
            }

            .style-grid,
            .paper-options {
                grid-template-columns: 1fr;
            }

            .export-section {
                grid-template-columns: 1fr;
            }

            #paperPreview {
                padding: 1.5rem;
                font-size: 16px;
            }
        }

        /* Imperfection effects */
        .imperfect-char {
            display: inline-block;
        }

        /* Templates Section */
        .templates-section {
            margin-top: 1rem;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
        }

        .template-btn {
            padding: 0.8rem;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.85rem;
            text-align: left;
        }

        body.dark-mode .template-btn {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px var(--shadow);
            border-color: var(--accent);
        }

        .template-title {
            display: block;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: var(--accent);
        }

        .template-desc {
            font-size: 0.75rem;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- Loading Indicator -->
    <div class="loading" id="loadingIndicator">Generating your handwritten notes...</div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">‚úçÔ∏è</div>
            <h1>NoteCraft</h1>
        </div>
        <div class="header-actions">
            <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <!-- Input Section -->
            <div class="control-section">
                <h3>üìù Your Notes</h3>
                <div class="control-group">
                    <textarea id="notesInput" placeholder="Paste or type your notes here...

Try using:
# Heading 1
## Heading 2
### Heading 3
- Bullet point
* Another bullet
**Bold text**
*Italic text*
==Highlighted text==

The app will automatically format these!" oninput="updatePreview()"></textarea>
                </div>
            </div>

            <!-- Handwriting Style -->
            <div class="control-section">
                <h3>‚ú® Handwriting Style</h3>
                <div class="style-grid">
                    <div class="style-option active" onclick="selectStyle('caveat')">
                        <div class="preview font-caveat">Abc</div>
                        <div class="name">Neat & Clean</div>
                    </div>
                    <div class="style-option" onclick="selectStyle('kalam')">
                        <div class="preview font-kalam">Abc</div>
                        <div class="name">School Style</div>
                    </div>
                    <div class="style-option" onclick="selectStyle('patrick')">
                        <div class="preview font-patrick">Abc</div>
                        <div class="name">Casual</div>
                    </div>
                    <div class="style-option" onclick="selectStyle('indie')">
                        <div class="preview font-indie">Abc</div>
                        <div class="name">Playful</div>
                    </div>
                    <div class="style-option" onclick="selectStyle('dancing')">
                        <div class="preview font-dancing">Abc</div>
                        <div class="name">Cursive</div>
                    </div>
                </div>
            </div>

            <!-- Ink Color -->
            <div class="control-section">
                <h3>üé® Ink Color</h3>
                <div class="color-options">
                    <div class="color-btn active" style="background: #000080;" onclick="selectColor('#000080')" title="Blue"></div>
                    <div class="color-btn" style="background: #000000;" onclick="selectColor('#000000')" title="Black"></div>
                    <div class="color-btn" style="background: #4B0082;" onclick="selectColor('#4B0082')" title="Purple"></div>
                    <div class="color-btn" style="background: #DC143C;" onclick="selectColor('#DC143C')" title="Red"></div>
                    <div class="color-btn" style="background: #006400;" onclick="selectColor('#006400')" title="Green"></div>
                    <div class="color-btn" style="background: #FF8C00;" onclick="selectColor('#FF8C00')" title="Orange"></div>
                </div>
            </div>

            <!-- Paper Type -->
            <div class="control-section">
                <h3>üìÑ Paper Style</h3>
                <div class="paper-options">
                    <div class="paper-option active" onclick="selectPaperType('plain')">
                        <span style="font-size: 1.5rem;">üìÉ</span>
                        <span>Plain</span>
                    </div>
                    <div class="paper-option" onclick="selectPaperType('ruled')">
                        <span style="font-size: 1.5rem;">üìù</span>
                        <span>Ruled</span>
                    </div>
                    <div class="paper-option" onclick="selectPaperType('dotted')">
                        <span style="font-size: 1.5rem;">‚ö™</span>
                        <span>Dotted</span>
                    </div>
                    <div class="paper-option" onclick="selectPaperType('grid')">
                        <span style="font-size: 1.5rem;">‚äû</span>
                        <span>Grid</span>
                    </div>
                </div>
            </div>

            <!-- Paper Color -->
            <div class="control-section">
                <h3>üé® Paper Color</h3>
                <div class="color-options">
                    <div class="color-btn active" style="background: #ffffff; border: 2px solid #ddd;" onclick="selectPaperColor('#ffffff')" title="White"></div>
                    <div class="color-btn" style="background: #fef9e7;" onclick="selectPaperColor('#fef9e7')" title="Cream"></div>
                    <div class="color-btn" style="background: #fffacd;" onclick="selectPaperColor('#fffacd')" title="Yellow"></div>
                    <div class="color-btn" style="background: #e8f4f8;" onclick="selectPaperColor('#e8f4f8')" title="Blue"></div>
                </div>
            </div>

            <!-- Customization Options -->
            <div class="control-section">
                <h3>‚öôÔ∏è Customization</h3>
                <div class="control-group">
                    <label>Layout Style:</label>
                    <div class="style-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="style-option active" onclick="selectLayout('single')" id="layout-single">
                            <div class="preview">üìÑ</div>
                            <div class="name">Single</div>
                        </div>
                        <div class="style-option" onclick="selectLayout('double')" id="layout-double">
                            <div class="preview">üìã</div>
                            <div class="name">2 Columns</div>
                        </div>
                        <div class="style-option" onclick="selectLayout('triple')" id="layout-triple">
                            <div class="preview">üì∞</div>
                            <div class="name">3 Columns</div>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Font Size: <span class="slider-value" id="fontSizeValue">20px</span></label>
                    <input type="range" id="fontSize" min="14" max="32" value="20" oninput="updateFontSize(this.value)">
                </div>
                <div class="control-group">
                    <label>Line Spacing: <span class="slider-value" id="lineSpacingValue">1.8</span></label>
                    <input type="range" id="lineSpacing" min="1.2" max="2.5" step="0.1" value="1.8" oninput="updateLineSpacing(this.value)">
                </div>
                <div class="control-group">
                    <label>Imperfection Level: <span class="slider-value" id="imperfectionValue">50%</span></label>
                    <input type="range" id="imperfection" min="0" max="100" value="50" oninput="updateImperfection(this.value)">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="smartFormat" checked onchange="updatePreview()">
                    <label for="smartFormat">Enable Smart Formatting</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="compactMode" onchange="updatePreview()">
                    <label for="compactMode">Compact Mode (Reduce spacing)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="autoDate" onchange="updatePreview()">
                    <label for="autoDate">Add Date & Time</label>
                </div>
            </div>

            <!-- Decorative Elements -->
            <div class="control-section">
                <h3>üé® Decorative Elements</h3>
                <div class="control-group">
                    <label style="margin-bottom: 0.8rem; display: block;">Quick Insert:</label>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                        <button class="tool-btn" onclick="insertText('[BOX]...[/BOX]')" style="font-size: 0.8rem;">üì¶ Box</button>
                        <button class="tool-btn" onclick="insertText('[IMP]...[/IMP]')" style="font-size: 0.8rem;">‚≠ê Important</button>
                        <button class="tool-btn" onclick="insertText('[FORMULA]...[/FORMULA]')" style="font-size: 0.8rem;">üìê Formula</button>
                        <button class="tool-btn" onclick="insertText('[NOTE]...[/NOTE]')" style="font-size: 0.8rem;">üìå Note</button>
                        <button class="tool-btn" onclick="insertText('[TIP]...[/TIP]')" style="font-size: 0.8rem;">üí° Tip</button>
                        <button class="tool-btn" onclick="insertText('[STAR]...[/STAR]')" style="font-size: 0.8rem;">‚≠ê Star</button>
                        <button class="tool-btn" onclick="insertText('---')" style="font-size: 0.8rem;">‚ûñ Divider</button>
                        <button class="tool-btn" onclick="insertText('[CIRCLE]...[/CIRCLE]')" style="font-size: 0.8rem;">‚≠ï Circle</button>
                    </div>
                </div>
                <div class="control-group" style="margin-top: 1rem;">
                    <label style="font-size: 0.85rem; opacity: 0.8;">
                        üí° Use these tags in your notes to add special formatting!
                    </label>
                </div>
            </div>

            <!-- Templates -->
            <div class="control-section">
                <h3>üìã Quick Templates</h3>
                <div class="templates-section">
                    <div class="template-grid">
                        <button class="template-btn" onclick="loadTemplate('physics')">
                            <span class="template-title">‚öõÔ∏è Physics</span>
                            <span class="template-desc">Derivations & formulas</span>
                        </button>
                        <button class="template-btn" onclick="loadTemplate('chemistry')">
                            <span class="template-title">üß™ Chemistry</span>
                            <span class="template-desc">Reactions & equations</span>
                        </button>
                        <button class="template-btn" onclick="loadTemplate('math')">
                            <span class="template-title">üìê Math</span>
                            <span class="template-desc">Solutions & proofs</span>
                        </button>
                        <button class="template-btn" onclick="loadTemplate('biology')">
                            <span class="template-title">üß¨ Biology</span>
                            <span class="template-desc">Diagrams & notes</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <div class="preview-header">
                <h3>üëÅÔ∏è Live Preview</h3>
                <div class="preview-actions">
                    <button class="icon-btn" onclick="toggleDrawingMode()" title="Toggle Drawing Mode" id="drawBtn">‚úèÔ∏è</button>
                    <button class="icon-btn" onclick="clearCanvas()" title="Clear Drawings">üóëÔ∏è</button>
                </div>
            </div>

            <div class="drawing-tools" id="drawingTools" style="display: none;">
                <button class="tool-btn active" onclick="setDrawingTool('pen')">Pen</button>
                <button class="tool-btn" onclick="setDrawingTool('highlighter')">Highlighter</button>
                <button class="tool-btn" onclick="setDrawingTool('eraser')">Eraser</button>
                <input type="color" id="drawColor" value="#000000" style="height: 40px; border-radius: 8px;">
            </div>

            <div class="paper-container">
                <div id="paperPreview" class="handwritten-text font-caveat">
                    Start typing or paste your notes to see the magic happen! ‚ú®
                </div>
                <canvas id="drawingCanvas"></canvas>
            </div>

            <div class="export-section">
                <button class="export-btn pdf" onclick="exportAsPDF()">üìÑ PDF</button>
                <button class="export-btn png" onclick="exportAsImage('png')">üñºÔ∏è PNG</button>
                <button class="export-btn jpg" onclick="exportAsImage('jpg')">üì∏ JPG</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentStyle = 'caveat';
        let currentColor = '#000080';
        let currentPaperType = 'plain';
        let currentPaperColor = '#ffffff';
        let imperfectionLevel = 50;
        let isDrawingMode = false;
        let isDrawing = false;
        let drawingTool = 'pen';
        let currentLayout = 'single';

        // Canvas setup
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let canvasHistory = [];
        let historyStep = -1;

        function resizeCanvas() {
            const preview = document.getElementById('paperPreview');
            canvas.width = preview.offsetWidth;
            canvas.height = preview.offsetHeight;
            if (canvasHistory.length > 0) {
                restoreCanvas();
            }
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Drawing functions
        function toggleDrawingMode() {
            isDrawingMode = !isDrawingMode;
            const canvas = document.getElementById('drawingCanvas');
            const tools = document.getElementById('drawingTools');
            const drawBtn = document.getElementById('drawBtn');
            
            if (isDrawingMode) {
                canvas.classList.add('drawing-enabled');
                tools.style.display = 'flex';
                drawBtn.style.background = '#e74c3c';
            } else {
                canvas.classList.remove('drawing-enabled');
                tools.style.display = 'none';
                drawBtn.style.background = '';
            }
        }

        function setDrawingTool(tool) {
            drawingTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function saveCanvas() {
            historyStep++;
            if (historyStep < canvasHistory.length) {
                canvasHistory.length = historyStep;
            }
            canvasHistory.push(canvas.toDataURL());
        }

        function restoreCanvas() {
            if (historyStep >= 0) {
                const img = new Image();
                img.src = canvasHistory[historyStep];
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
            }
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });

        function startDrawing(e) {
            if (!isDrawingMode) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing || !isDrawingMode) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (drawingTool === 'pen') {
                ctx.strokeStyle = document.getElementById('drawColor').value;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 1;
            } else if (drawingTool === 'highlighter') {
                ctx.strokeStyle = '#FFEB3B';
                ctx.lineWidth = 20;
                ctx.globalAlpha = 0.3;
            } else if (drawingTool === 'eraser') {
                ctx.strokeStyle = currentPaperColor;
                ctx.lineWidth = 20;
                ctx.globalAlpha = 1;
            }
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            saveCanvas();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvasHistory = [];
            historyStep = -1;
        }

        // Style selection
        function selectStyle(style) {
            currentStyle = style;
            document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('active'));
            event.target.closest('.style-option').classList.add('active');
            updatePreview();
        }

        function selectColor(color) {
            currentColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updatePreview();
        }

        function selectPaperType(type) {
            currentPaperType = type;
            document.querySelectorAll('.paper-option').forEach(opt => opt.classList.remove('active'));
            event.target.closest('.paper-option').classList.add('active');
            updatePreview();
        }

        function selectPaperColor(color) {
            currentPaperColor = color;
            document.querySelectorAll('.color-options')[1].querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updatePreview();
        }

        function selectLayout(layout) {
            currentLayout = layout;
            document.getElementById('layout-single').classList.remove('active');
            document.getElementById('layout-double').classList.remove('active');
            document.getElementById('layout-triple').classList.remove('active');
            document.getElementById('layout-' + layout).classList.add('active');
            updatePreview();
        }

        function insertText(text) {
            const textarea = document.getElementById('notesInput');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const currentText = textarea.value;
            
            // Insert text at cursor position
            const newText = currentText.substring(0, start) + text + currentText.substring(end);
            textarea.value = newText;
            
            // Move cursor to inside the tags if it's a tag pair
            if (text.includes('...')) {
                const cursorPos = start + text.indexOf('...');
                textarea.setSelectionRange(cursorPos, cursorPos + 3);
            } else {
                textarea.setSelectionRange(start + text.length, start + text.length);
            }
            
            textarea.focus();
            updatePreview();
        }

        function updateFontSize(value) {
            document.getElementById('fontSizeValue').textContent = value + 'px';
            updatePreview();
        }

        function updateLineSpacing(value) {
            document.getElementById('lineSpacingValue').textContent = value;
            updatePreview();
        }

        function updateImperfection(value) {
            imperfectionLevel = value;
            document.getElementById('imperfectionValue').textContent = value + '%';
            updatePreview();
        }

        // Preview update with smart formatting
        function updatePreview() {
            const input = document.getElementById('notesInput').value;
            const preview = document.getElementById('paperPreview');
            const fontSize = document.getElementById('fontSize').value;
            const lineSpacing = document.getElementById('lineSpacing').value;
            const smartFormat = document.getElementById('smartFormat').checked;
            const autoDate = document.getElementById('autoDate').checked;
            
            if (!input.trim()) {
                preview.innerHTML = 'Start typing or paste your notes to see the magic happen! ‚ú®';
                return;
            }

            let formatted = input;

            if (smartFormat) {
                // Add date if enabled
                if (autoDate) {
                    const now = new Date();
                    const dateStr = now.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    const timeStr = now.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    formatted = `<div class="date-stamp">üìÖ ${dateStr} ‚Ä¢ ‚è∞ ${timeStr}</div>\n` + formatted;
                }

                // Convert custom tags first
                // Box tags
                formatted = formatted.replace(/\[BOX\](.*?)\[\/BOX\]/gs, '<div class="box">$1</div>');
                formatted = formatted.replace(/\[IMP\](.*?)\[\/IMP\]/gs, '<div class="important-box">$1</div>');
                formatted = formatted.replace(/\[FORMULA\](.*?)\[\/FORMULA\]/gs, '<div class="formula-box">$1</div>');
                
                // Inline markers
                formatted = formatted.replace(/\[STAR\](.*?)\[\/STAR\]/g, '<span class="star">$1</span>');
                formatted = formatted.replace(/\[NOTE\](.*?)\[\/NOTE\]/g, '<span class="note">$1</span>');
                formatted = formatted.replace(/\[TIP\](.*?)\[\/TIP\]/g, '<span class="tip">$1</span>');
                formatted = formatted.replace(/\[IMPORTANT\](.*?)\[\/IMPORTANT\]/g, '<span class="important">$1</span>');
                formatted = formatted.replace(/\[CIRCLE\](.*?)\[\/CIRCLE\]/g, '<span class="circled">$1</span>');
                
                // Arrows
                formatted = formatted.replace(/\[‚Üí\]/g, '<span class="arrow-right"></span>');
                formatted = formatted.replace(/\[‚Üê\]/g, '<span class="arrow-left"></span>');
                formatted = formatted.replace(/\[‚Üî\]/g, '<span class="arrow-both"></span>');
                
                // Divider
                formatted = formatted.replace(/^---$/gm, '<div class="divider">‚ú¶</div>');
                
                // Convert markdown-style formatting
                // Headings
                formatted = formatted.replace(/^# (.*$)/gim, '<h1>$1</h1>');
                formatted = formatted.replace(/^## (.*$)/gim, '<h2>$1</h2>');
                formatted = formatted.replace(/^### (.*$)/gim, '<h3>$1</h3>');
                
                // Bold
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Italic
                formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Highlight
                formatted = formatted.replace(/==(.*?)==/g, '<mark>$1</mark>');
                
                // Underline variations
                formatted = formatted.replace(/__(.*?)__/g, '<span class="double-underline">$1</span>');
                formatted = formatted.replace(/~(.*?)~/g, '<span class="underline">$1</span>');
                
                // Bullet lists with special markers
                let lines = formatted.split('\n');
                let inList = false;
                let listType = 'normal';
                let processedLines = [];
                
                for (let i = 0; i < lines.length; i++) {
                    let line = lines[i];
                    
                    // Check for special bullet types
                    if (line.match(/^[\-] /)) {
                        if (!inList) {
                            processedLines.push('<ul class="dash-bullets">');
                            inList = true;
                            listType = 'dash';
                        } else if (listType !== 'dash') {
                            processedLines.push('</ul><ul class="dash-bullets">');
                            listType = 'dash';
                        }
                        processedLines.push('<li>' + line.substring(2) + '</li>');
                    } else if (line.match(/^[>] /)) {
                        if (!inList) {
                            processedLines.push('<ul class="arrow-bullets">');
                            inList = true;
                            listType = 'arrow';
                        } else if (listType !== 'arrow') {
                            processedLines.push('</ul><ul class="arrow-bullets">');
                            listType = 'arrow';
                        }
                        processedLines.push('<li>' + line.substring(2) + '</li>');
                    } else if (line.match(/^[\*] /)) {
                        if (!inList) {
                            processedLines.push('<ul class="star-bullets">');
                            inList = true;
                            listType = 'star';
                        } else if (listType !== 'star') {
                            processedLines.push('</ul><ul class="star-bullets">');
                            listType = 'star';
                        }
                        processedLines.push('<li>' + line.substring(2) + '</li>');
                    } else if (line.match(/^[+] /)) {
                        if (!inList) {
                            processedLines.push('<ul class="check-bullets">');
                            inList = true;
                            listType = 'check';
                        } else if (listType !== 'check') {
                            processedLines.push('</ul><ul class="check-bullets">');
                            listType = 'check';
                        }
                        processedLines.push('<li>' + line.substring(2) + '</li>');
                    } else {
                        if (inList) {
                            processedLines.push('</ul>');
                            inList = false;
                        }
                        processedLines.push(line);
                    }
                }
                
                if (inList) {
                    processedLines.push('</ul>');
                }
                
                formatted = processedLines.join('\n');
                
                // Line breaks
                formatted = formatted.replace(/\n/g, '<br>');
            } else {
                formatted = formatted.replace(/\n/g, '<br>');
            }

            // Apply imperfection
            if (imperfectionLevel > 0) {
                formatted = applyImperfection(formatted);
            }

            // Update preview
            preview.innerHTML = formatted;
            preview.className = `handwritten-text font-${currentStyle}`;
            
            // Add layout class
            if (currentLayout !== 'single') {
                preview.classList.add('layout-' + currentLayout);
            }
            
            // Add compact mode class
            if (document.getElementById('compactMode').checked) {
                preview.classList.add('compact-mode');
            }
            
            preview.style.color = currentColor;
            preview.style.fontSize = fontSize + 'px';
            preview.style.lineHeight = lineSpacing;
            preview.style.backgroundColor = currentPaperColor;
            
            // Update paper type
            preview.classList.remove('paper-ruled', 'paper-dotted', 'paper-grid');
            if (currentPaperType !== 'plain') {
                preview.classList.add('paper-' + currentPaperType);
            }

            // Resize canvas to match
            resizeCanvas();
        }

        function applyImperfection(text) {
            // Add slight rotation and spacing variations to characters
            const level = imperfectionLevel / 100;
            let result = '';
            let inTag = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                
                if (char === '<') inTag = true;
                if (char === '>') inTag = false;
                
                if (!inTag && char.match(/[a-zA-Z0-9]/)) {
                    const rotation = (Math.random() - 0.5) * 3 * level;
                    const spacing = Math.random() * 2 * level;
                    result += `<span class="imperfect-char" style="transform: rotate(${rotation}deg); margin-right: ${spacing}px; display: inline-block;">${char}</span>`;
                } else {
                    result += char;
                }
            }
            
            return result;
        }

        // Templates
        function loadTemplate(type) {
            const templates = {
                physics: `# Physics - Quick Reference Sheet

## Kinematics

[FORMULA]
- v = u + at
- s = ut + ¬Ωat¬≤
- v¬≤ = u¬≤ + 2as
[/FORMULA]

[NOTE]Where: v=final, u=initial, a=acceleration, t=time, s=displacement[/NOTE]

## Newton's Laws

[IMP]
**First Law:** Inertia - Object maintains state unless force applied
**Second Law:** F = ma
**Third Law:** Action = Reaction (opposite direction)
[/IMP]

## Work, Energy & Power

- Work: W = F¬∑s¬∑cosŒ∏
- Kinetic Energy: KE = ¬Ωmv¬≤
- Potential Energy: PE = mgh
- [STAR]Power: P = W/t = F¬∑v[/STAR]

---

## Circular Motion

> v = rœâ
> a = v¬≤/r = rœâ¬≤
> [CIRCLE]F = mv¬≤/r[/CIRCLE]

## Gravitation

[FORMULA]
- F = Gm‚ÇÅm‚ÇÇ/r¬≤
- g = GM/R¬≤
- Orbital velocity: v = ‚àö(GM/r)
[/FORMULA]

[TIP]Remember: At surface r = R[/TIP]

## Thermodynamics

+ First Law: ŒîU = Q - W
+ PV = nRT (Ideal Gas)
+ Efficiency: Œ∑ = W/Q‚ÇÅ

## Waves & Sound

- v = fŒª
- [STAR]Doppler: f' = f(v¬±v‚ÇÄ)/(v‚àìv‚Çõ)[/STAR]
- Intensity ‚àù Amplitude¬≤

## Electricity

[BOX]
**Ohm's Law:** V = IR
**Power:** P = VI = I¬≤R = V¬≤/R
**Charge:** Q = It
[/BOX]

## Optics

- Mirror/Lens: 1/f = 1/v + 1/u
- Magnification: m = v/u
- [IMPORTANT]Snell's Law: Œº‚ÇÅsinŒ∏‚ÇÅ = Œº‚ÇÇsinŒ∏‚ÇÇ[/IMPORTANT]`,

                chemistry: `# Chemistry - Formula & Reaction Guide

## Mole Concept

[FORMULA]
- n = m/M (mass/molar mass)
- n = V/22.4 L (at STP)
- n = N/N‚Çê
- [CIRCLE]N‚Çê = 6.022√ó10¬≤¬≥[/CIRCLE]
[/FORMULA]

## Acids & Bases

[IMP]
pH + pOH = 14
pH = -log[H‚Å∫]
pOH = -log[OH‚Åª]
[/IMP]

**Strong Acids:** HCl, H‚ÇÇSO‚ÇÑ, HNO‚ÇÉ
**Strong Bases:** NaOH, KOH

---

## Redox Reactions

[NOTE]OIL RIG - Oxidation Is Loss, Reduction Is Gain (of electrons)[/NOTE]

**Example:**
- Zn ‚Üí Zn¬≤‚Å∫ + 2e‚Åª [‚Üí] Oxidation
- Cu¬≤‚Å∫ + 2e‚Åª ‚Üí Cu [‚Üí] Reduction

## Common Reactions

**Combustion:**
> CH‚ÇÑ + 2O‚ÇÇ ‚Üí CO‚ÇÇ + 2H‚ÇÇO

**Neutralization:**
> HCl + NaOH ‚Üí NaCl + H‚ÇÇO

**Displacement:**
> Zn + CuSO‚ÇÑ ‚Üí ZnSO‚ÇÑ + Cu

## Gas Laws

[BOX]
**Ideal Gas:** PV = nRT
**Combined:** P‚ÇÅV‚ÇÅ/T‚ÇÅ = P‚ÇÇV‚ÇÇ/T‚ÇÇ
**Density:** d = PM/RT
[/BOX]

[TIP]R = 0.0821 L¬∑atm/(mol¬∑K)[/TIP]

## Equilibrium

- Kc = [Products]/[Reactants]
- [STAR]Kp = Kc(RT)^Œîn[/STAR]
- Le Chatelier's Principle

## Electrochemistry

[FORMULA]
- E¬∞cell = E¬∞cathode - E¬∞anode
- ŒîG¬∞ = -nFE¬∞
- Charge: Q = It/96500
[/FORMULA]

## Organic Chemistry

**Functional Groups:**
+ Alcohol: -OH
+ Aldehyde: -CHO
+ Ketone: >C=O
+ Carboxylic Acid: -COOH`,

                math: `# Mathematics - Essential Formulas

## Algebra

[IMP]
**Quadratic Formula:**
x = (-b ¬± ‚àö(b¬≤-4ac))/2a

**Discriminant:** Œî = b¬≤-4ac
- Œî > 0: Two real roots
- Œî = 0: One real root
- Œî < 0: Complex roots
[/IMP]

**Binomial Identities:**
- (a+b)¬≤ = a¬≤+2ab+b¬≤
- (a-b)¬≤ = a¬≤-2ab+b¬≤
- [CIRCLE]a¬≤-b¬≤ = (a+b)(a-b)[/CIRCLE]
- (a+b)¬≥ = a¬≥+3a¬≤b+3ab¬≤+b¬≥

---

## Progressions

[FORMULA]
**AP:**
- nth term: a‚Çô = a+(n-1)d
- Sum: S‚Çô = n/2[2a+(n-1)d]

**GP:**
- nth term: a‚Çô = ar‚Åø‚Åª¬π
- Sum: S‚Çô = a(r‚Åø-1)/(r-1)
[/FORMULA]

## Trigonometry

[BOX]
**Fundamental:**
- sin¬≤Œ∏ + cos¬≤Œ∏ = 1
- 1 + tan¬≤Œ∏ = sec¬≤Œ∏
- 1 + cot¬≤Œ∏ = cosec¬≤Œ∏
[/BOX]

**Compound Angles:**
> sin(A¬±B) = sinA cosB ¬± cosA sinB
> cos(A¬±B) = cosA cosB ‚àì sinA sinB

[TIP]Remember: Signs change in cos![/TIP]

## Calculus

**Derivatives:**
- d/dx(x‚Åø) = nx‚Åø‚Åª¬π
- d/dx(sin x) = cos x
- d/dx(cos x) = -sin x
- [STAR]d/dx(eÀ£) = eÀ£[/STAR]
- d/dx(ln x) = 1/x

**Integration:**
+ ‚à´x‚Åø dx = x‚Åø‚Å∫¬π/(n+1)
+ ‚à´eÀ£ dx = eÀ£ + C
+ ‚à´1/x dx = ln|x| + C

---

## Coordinate Geometry

[FORMULA]
Distance: d = ‚àö[(x‚ÇÇ-x‚ÇÅ)¬≤+(y‚ÇÇ-y‚ÇÅ)¬≤]
Midpoint: M = ((x‚ÇÅ+x‚ÇÇ)/2, (y‚ÇÅ+y‚ÇÇ)/2)
Slope: m = (y‚ÇÇ-y‚ÇÅ)/(x‚ÇÇ-x‚ÇÅ)
[/FORMULA]

**Line Equations:**
- Slope form: y = mx + c
- Point-slope: y-y‚ÇÅ = m(x-x‚ÇÅ)

**Circle:**
- Standard: x¬≤ + y¬≤ = r¬≤
- General: (x-h)¬≤ + (y-k)¬≤ = r¬≤`,

                biology: `# Biology - Quick Study Guide

## Cell Structure

[IMP]
**Prokaryotic vs Eukaryotic:**
- Prokaryotic: No nucleus (Bacteria)
- Eukaryotic: Nucleus present (Animals, Plants)
[/IMP]

**Key Organelles:**
- [STAR]Nucleus[/STAR]: Genetic control center
- Mitochondria: ATP production ("Powerhouse")
- Ribosomes: Protein synthesis
- ER: Transport network
- Golgi: Packaging & secretion

---

## Photosynthesis

[FORMULA]
**Overall Equation:**
6CO‚ÇÇ + 12H‚ÇÇO ‚Üí C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ + 6O‚ÇÇ + 6H‚ÇÇO
[/FORMULA]

[BOX]
**Light Reaction:** (Thylakoid)
- Water splitting
- ATP & NADPH formation
- O‚ÇÇ released

**Dark Reaction:** (Stroma)
- CO‚ÇÇ fixation (Calvin Cycle)
- Glucose synthesis
[/BOX]

## Respiration

**Stages:**
+ [CIRCLE]Glycolysis[/CIRCLE]: 2 ATP (Cytoplasm)
+ Krebs Cycle: 2 ATP (Mitochondria)
+ ETC: 34 ATP (Inner membrane)

[TIP]Total: 38 ATP per glucose[/TIP]

---

## DNA & RNA

[NOTE]DNA: Deoxyribonucleic Acid
RNA: Ribonucleic Acid[/NOTE]

**DNA Structure:**
> Double helix
> Base pairs: A-T (2 bonds), G-C (3 bonds)
> Antiparallel strands

**Central Dogma:**
DNA [‚Üí] RNA [‚Üí] Protein

## Genetics

[IMP]
**Mendel's Laws:**
1. Law of Segregation
2. Law of Independent Assortment
[/IMP]

**Genetic Ratios:**
- Monohybrid: 3:1 (Phenotype), 1:2:1 (Genotype)
- Dihybrid: 9:3:3:1
- Test Cross: 1:1

## Ecology

**Trophic Levels:**
Producers ‚Üí Primary ‚Üí Secondary ‚Üí Tertiary

[STAR]10% Energy Rule[/STAR]: Only 10% energy transfers to next level

**Ecological Pyramids:**
+ Number
+ Biomass
+ Energy (Always upright!)

---

## Plant Hormones

- **Auxins:** Cell elongation, apical dominance
- **Gibberellins:** Stem growth, seed germination
- **Cytokinins:** Cell division
- **ABA:** Stomatal closure, dormancy
- **Ethylene:** Fruit ripening`
            };

            document.getElementById('notesInput').value = templates[type] || '';
            updatePreview();
        }

        // Export functions
        function showLoading() {
            document.getElementById('loadingIndicator').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').classList.remove('show');
        }

        async function exportAsPDF() {
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const preview = document.getElementById('paperPreview');
                const canvasEl = document.getElementById('drawingCanvas');
                
                // Create high-quality canvas capture
                const scale = 3; // 3x resolution for better quality
                const canvas = await html2canvas(preview, {
                    scale: scale,
                    backgroundColor: currentPaperColor,
                    logging: false,
                    useCORS: true
                });

                // Create a temporary canvas to combine preview and drawings
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Draw the preview
                tempCtx.drawImage(canvas, 0, 0);
                
                // Draw the canvas overlay (scale it to match)
                if (canvasEl.width > 0 && canvasEl.height > 0) {
                    tempCtx.drawImage(canvasEl, 0, 0, tempCanvas.width, tempCanvas.height);
                }

                // Create PDF (A4 size)
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                // Calculate aspect ratio
                const imgWidth = tempCanvas.width;
                const imgHeight = tempCanvas.height;
                
                // Calculate how many pages we need
                const ratio = imgWidth / imgHeight;
                const pageRatio = pdfWidth / pdfHeight;
                
                let finalWidth, finalHeight;
                
                if (ratio > pageRatio) {
                    // Image is wider - fit to width
                    finalWidth = pdfWidth;
                    finalHeight = pdfWidth / ratio;
                } else {
                    // Image is taller - fit to width and split pages
                    finalWidth = pdfWidth;
                    finalHeight = pdfWidth / ratio;
                }
                
                // If content fits in one page
                if (finalHeight <= pdfHeight) {
                    const imgData = tempCanvas.toDataURL('image/jpeg', 1.0);
                    pdf.addImage(imgData, 'JPEG', 0, 0, finalWidth, finalHeight);
                    
                    // Add watermark "JEEro" in center
                    pdf.setFontSize(60);
                    pdf.setTextColor(200, 200, 200);
                    pdf.setFont(undefined, 'bold');
                    pdf.saveGraphicsState();
                    pdf.setGState(new pdf.GState({ opacity: 0.1 }));
                    const watermarkText = 'JEEro';
                    const textWidth = pdf.getTextWidth(watermarkText);
                    pdf.text(watermarkText, (pdfWidth - textWidth) / 2, pdfHeight / 2, { 
                        angle: 45,
                        align: 'center'
                    });
                    pdf.restoreGraphicsState();
                } else {
                    // Multiple pages needed
                    const pagesNeeded = Math.ceil(finalHeight / pdfHeight);
                    const pageHeightInCanvas = (tempCanvas.height / pagesNeeded);
                    
                    for (let i = 0; i < pagesNeeded; i++) {
                        // Create a canvas for each page
                        const pageCanvas = document.createElement('canvas');
                        pageCanvas.width = tempCanvas.width;
                        pageCanvas.height = pageHeightInCanvas;
                        const pageCtx = pageCanvas.getContext('2d');
                        
                        // Fill with paper color
                        pageCtx.fillStyle = currentPaperColor;
                        pageCtx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);
                        
                        // Draw the slice of content
                        pageCtx.drawImage(
                            tempCanvas,
                            0, i * pageHeightInCanvas, // Source x, y
                            tempCanvas.width, pageHeightInCanvas, // Source width, height
                            0, 0, // Dest x, y
                            pageCanvas.width, pageCanvas.height // Dest width, height
                        );
                        
                        // Add to PDF
                        const pageImgData = pageCanvas.toDataURL('image/jpeg', 1.0);
                        
                        if (i > 0) {
                            pdf.addPage();
                        }
                        
                        pdf.addImage(pageImgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                        
                        // Add watermark "JEEro" in center
                        pdf.setFontSize(60);
                        pdf.setTextColor(200, 200, 200);
                        pdf.setFont(undefined, 'bold');
                        pdf.saveGraphicsState();
                        pdf.setGState(new pdf.GState({ opacity: 0.1 }));
                        const watermarkText = 'JEEro';
                        const textWidth = pdf.getTextWidth(watermarkText);
                        pdf.text(watermarkText, (pdfWidth - textWidth) / 2, pdfHeight / 2, { 
                            angle: 45,
                            align: 'center'
                        });
                        pdf.restoreGraphicsState();
                        
                        // Add page number at bottom
                        pdf.setFontSize(10);
                        pdf.setTextColor(150);
                        pdf.setFont(undefined, 'normal');
                        pdf.text(`Page ${i + 1} of ${pagesNeeded}`, pdfWidth / 2, pdfHeight - 5, { align: 'center' });
                    }
                }
                
                pdf.save('handwritten-notes.pdf');
                
                hideLoading();
            } catch (error) {
                console.error('PDF export error:', error);
                alert('Error exporting PDF. Please try again.');
                hideLoading();
            }
        }

        async function exportAsImage(format) {
            showLoading();
            
            try {
                const preview = document.getElementById('paperPreview');
                const canvasEl = document.getElementById('drawingCanvas');
                
                // Create high-quality canvas capture
                const scale = 4; // 4x resolution for high quality
                const canvas = await html2canvas(preview, {
                    scale: scale,
                    backgroundColor: currentPaperColor,
                    logging: false,
                    useCORS: true
                });

                // Create a temporary canvas to combine preview and drawings
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Draw the preview
                tempCtx.drawImage(canvas, 0, 0);
                
                // Draw the canvas overlay
                if (canvasEl.width > 0 && canvasEl.height > 0) {
                    tempCtx.drawImage(canvasEl, 0, 0, tempCanvas.width, tempCanvas.height);
                }

                // Convert to desired format
                const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
                const quality = format === 'jpg' ? 0.95 : 1.0;
                
                tempCanvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `handwritten-notes.${format}`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    hideLoading();
                }, mimeType, quality);
                
            } catch (error) {
                console.error('Image export error:', error);
                alert('Error exporting image. Please try again.');
                hideLoading();
            }
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.theme-toggle');
            if (document.body.classList.contains('dark-mode')) {
                btn.textContent = '‚òÄÔ∏è Light Mode';
            } else {
                btn.textContent = 'üåô Dark Mode';
            }
        }

        // Initialize with example content
        window.addEventListener('load', () => {
            document.getElementById('notesInput').value = `# Physics - Motion & Forces üìö

## Kinematics Equations

[FORMULA]
- v = u + at
- s = ut + ¬Ωat¬≤
- v¬≤ = u¬≤ + 2as
[/FORMULA]

[NOTE]Where: v=final velocity, u=initial, a=acceleration, t=time, s=displacement[/NOTE]

---

## Newton's Laws

[IMP]
**First Law:** Inertia
An object maintains its state unless external force acts
[/IMP]

[STAR]**Second Law:** F = ma[/STAR]

> Force = Mass √ó Acceleration
> SI Unit: Newton (N)

**Third Law:** Action = Reaction (opposite directions)

---

## Energy Formulas

[BOX]
**Kinetic Energy:** KE = ¬Ωmv¬≤
**Potential Energy:** PE = mgh
**Power:** P = W/t
[/BOX]

[TIP]Try 2-column layout for compact notes![/TIP]

**Different Bullet Styles:**
- Dash bullets (use -)
> Arrow bullets (use >)
* Star bullets (use *)
+ Check bullets (use +)

==Try the decorative elements panel!== üé®`;
            updatePreview();
        });

        // Save preferences to localStorage
        window.addEventListener('beforeunload', () => {
            const preferences = {
                style: currentStyle,
                color: currentColor,
                paperType: currentPaperType,
                paperColor: currentPaperColor,
                fontSize: document.getElementById('fontSize').value,
                lineSpacing: document.getElementById('lineSpacing').value,
                imperfection: imperfectionLevel
            };
            localStorage.setItem('notecraftPreferences', JSON.stringify(preferences));
        });

        // Load preferences on startup
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('notecraftPreferences');
            if (saved) {
                const prefs = JSON.parse(saved);
                // Apply saved preferences
                if (prefs.fontSize) document.getElementById('fontSize').value = prefs.fontSize;
                if (prefs.lineSpacing) document.getElementById('lineSpacing').value = prefs.lineSpacing;
                if (prefs.imperfection) document.getElementById('imperfection').value = prefs.imperfection;
                
                updateFontSize(prefs.fontSize || 20);
                updateLineSpacing(prefs.lineSpacing || 1.8);
                updateImperfection(prefs.imperfection || 50);
            }
        });
    </script>
</body>
</html>